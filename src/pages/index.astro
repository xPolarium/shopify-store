---
import '@/styles/globals.css';
import BaseLayout from '../layouts/BaseLayout.astro';
import { Button } from "@/components/ui/button";

import HeroSection from "@/components/HeroSection";
import ProductList from "@/components/ProductList";

import { config } from "../utils/config";
import { getProductByHandle, getProducts } from "../utils/shopify";
import { ShopifyProvider } from '@shopify/hydrogen-react';
import ProductCard from '@/components/ProductCard';

const headers = Astro.request.headers;
const ip = headers.get("x-vercel-forwarded-for") || Astro.clientAddress;

const products = await getProducts({buyerIp: ip, limit: 17});

const product = await getProductByHandle({buyerIp: ip, handle: "the-minimal-snowboard"})
---

<ShopifyProvider
	storeDomain={config.shopifyShop}
	storefrontToken={config.publicShopifyAccessToken}
	storefrontApiVersion="2023-07"
	countryIsoCode="US"
	languageIsoCode="EN"
>
	<BaseLayout title="Shopify Store">
			<HeroSection />
			<ProductList products={products}/>
	</BaseLayout>

	<ProductCard product={product}/>
</ShopifyProvider>